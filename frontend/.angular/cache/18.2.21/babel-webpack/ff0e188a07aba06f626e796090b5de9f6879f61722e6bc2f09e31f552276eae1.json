{"ast":null,"code":"import { TasksService } from '../../services/tasks.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/tasks.service\";\nimport * as i2 from \"@angular/common\";\nfunction CalendarComponent_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 9);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const d_r1 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(d_r1);\n  }\n}\nfunction CalendarComponent_ng_container_13_div_1_div_3_span_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 20);\n    i0.ɵɵtext(1, \"Alta\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CalendarComponent_ng_container_13_div_1_div_3_span_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 21);\n    i0.ɵɵtext(1, \"Media\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CalendarComponent_ng_container_13_div_1_div_3_span_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 22);\n    i0.ɵɵtext(1, \"Baja\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CalendarComponent_ng_container_13_div_1_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 15)(1, \"span\", 16);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, CalendarComponent_ng_container_13_div_1_div_3_span_3_Template, 2, 0, \"span\", 17)(4, CalendarComponent_ng_container_13_div_1_div_3_span_4_Template, 2, 0, \"span\", 18)(5, CalendarComponent_ng_container_13_div_1_div_3_span_5_Template, 2, 0, \"span\", 19);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const c_r3 = i0.ɵɵnextContext().$implicit;\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(c_r3.tasks.length);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.hasHigh(c_r3));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.hasMed(c_r3));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.hasLow(c_r3));\n  }\n}\nfunction CalendarComponent_ng_container_13_div_1_ul_4_li_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const t_r5 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", t_r5.title, \" \");\n  }\n}\nfunction CalendarComponent_ng_container_13_div_1_ul_4_li_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const c_r3 = i0.ɵɵnextContext(2).$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"+\", c_r3.tasks.length - 2, \" m\\u00E1s\\u2026\");\n  }\n}\nfunction CalendarComponent_ng_container_13_div_1_ul_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\", 23);\n    i0.ɵɵtemplate(1, CalendarComponent_ng_container_13_div_1_ul_4_li_1_Template, 2, 1, \"li\", 7);\n    i0.ɵɵpipe(2, \"slice\");\n    i0.ɵɵtemplate(3, CalendarComponent_ng_container_13_div_1_ul_4_li_3_Template, 2, 1, \"li\", 24);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const c_r3 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind3(2, 2, c_r3.tasks, 0, 2));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", c_r3.tasks.length > 2);\n  }\n}\nfunction CalendarComponent_ng_container_13_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 11);\n    i0.ɵɵlistener(\"click\", function CalendarComponent_ng_container_13_div_1_Template_div_click_0_listener() {\n      const c_r3 = i0.ɵɵrestoreView(_r2).$implicit;\n      const ctx_r3 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r3.openDay(c_r3));\n    });\n    i0.ɵɵelementStart(1, \"div\", 12);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, CalendarComponent_ng_container_13_div_1_div_3_Template, 6, 4, \"div\", 13)(4, CalendarComponent_ng_container_13_div_1_ul_4_Template, 4, 6, \"ul\", 14);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const c_r3 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵclassProp(\"out\", !c_r3.inMonth)(\"today\", ctx_r3.isToday(c_r3));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(c_r3.date.getDate());\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", c_r3.tasks.length);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", c_r3.tasks.length);\n  }\n}\nfunction CalendarComponent_ng_container_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, CalendarComponent_ng_container_13_div_1_Template, 5, 7, \"div\", 10);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const week_r6 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", week_r6);\n  }\n}\nfunction CalendarComponent_div_14_div_5_span_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 34);\n    i0.ɵɵtext(1, \"Completada\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CalendarComponent_div_14_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 29)(1, \"div\", 30);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 31)(4, \"span\", 32);\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"titlecase\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, CalendarComponent_div_14_div_5_span_7_Template, 2, 0, \"span\", 33);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const t_r7 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵclassProp(\"done\", t_r7.done);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(t_r7.title);\n    i0.ɵɵadvance(2);\n    i0.ɵɵclassProp(\"h\", t_r7.priority === \"high\")(\"m\", t_r7.priority === \"med\")(\"l\", t_r7.priority === \"low\");\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(6, 11, t_r7.priority || \"low\"), \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", t_r7.done);\n  }\n}\nfunction CalendarComponent_div_14_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 35);\n    i0.ɵɵtext(1, \"No hay tareas para este d\\u00EDa.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CalendarComponent_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 25)(1, \"div\", 26);\n    i0.ɵɵtext(2, \" Tareas del \");\n    i0.ɵɵelementStart(3, \"b\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(5, CalendarComponent_div_14_div_5_Template, 8, 13, \"div\", 27)(6, CalendarComponent_div_14_div_6_Template, 2, 0, \"div\", 28);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(ctx_r3.selectedKey);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.selectedTasks);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r3.selectedTasks.length);\n  }\n}\nexport let CalendarComponent = /*#__PURE__*/(() => {\n  class CalendarComponent {\n    constructor(tasksService) {\n      this.tasksService = tasksService;\n      this.viewDate = new Date(); // mes que se está viendo\n      this.weeks = []; // 6 filas x 7 columnas\n      this.selectedKey = null;\n      this.selectedTasks = [];\n      this.allTasks = [];\n      this.tasksByDay = new Map();\n      // nombres de días como propiedad (evita llamar funciones en el template)\n      this.dayNames = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];\n    }\n    ngOnInit() {\n      this.loadTasks();\n    }\n    // ---------- Carga y agrupación ----------\n    loadTasks() {\n      this.tasksService.list().subscribe({\n        next: data => {\n          this.allTasks = data || [];\n          this.groupByDay();\n          this.buildCalendar();\n        },\n        error: () => {\n          this.allTasks = [];\n          this.tasksByDay.clear();\n          this.buildCalendar();\n        }\n      });\n    }\n    groupByDay() {\n      this.tasksByDay.clear();\n      for (const t of this.allTasks) {\n        if (!t?.dueDate) continue;\n        const key = this.keyFromISO(t.dueDate);\n        if (!this.tasksByDay.has(key)) this.tasksByDay.set(key, []);\n        this.tasksByDay.get(key).push(t);\n      }\n    }\n    // ---------- Calendario ----------\n    buildCalendar() {\n      const y = this.viewDate.getFullYear();\n      const m = this.viewDate.getMonth();\n      const first = new Date(y, m, 1);\n      const start = new Date(first);\n      // Comienza el domingo: 0=dom,1=lun,...6=sáb\n      const offset = first.getDay(); // 0..6\n      start.setDate(first.getDate() - offset);\n      const weeks = [];\n      let cursor = new Date(start);\n      for (let w = 0; w < 6; w++) {\n        const row = [];\n        for (let d = 0; d < 7; d++) {\n          const key = this.keyFromDate(cursor);\n          row.push({\n            date: new Date(cursor),\n            inMonth: cursor.getMonth() === m,\n            key,\n            tasks: this.tasksByDay.get(key) || []\n          });\n          cursor.setDate(cursor.getDate() + 1);\n        }\n        weeks.push(row);\n      }\n      this.weeks = weeks;\n      // Si hay un día seleccionado y ya no está en el mes, limpiar panel\n      if (this.selectedKey) {\n        const stillVisible = weeks.flat().some(c => c.key === this.selectedKey);\n        if (!stillVisible) {\n          this.selectedKey = null;\n          this.selectedTasks = [];\n        }\n      }\n    }\n    // ---------- Navegación ----------\n    prevMonth() {\n      this.viewDate = new Date(this.viewDate.getFullYear(), this.viewDate.getMonth() - 1, 1);\n      this.buildCalendar();\n    }\n    nextMonth() {\n      this.viewDate = new Date(this.viewDate.getFullYear(), this.viewDate.getMonth() + 1, 1);\n      this.buildCalendar();\n    }\n    goToday() {\n      this.viewDate = new Date();\n      this.buildCalendar();\n    }\n    // ---------- Selección de día ----------\n    openDay(cell) {\n      this.selectedKey = cell.key;\n      this.selectedTasks = [...cell.tasks].sort((a, b) => {\n        const ap = a.priority || 'low';\n        const bp = b.priority || 'low';\n        const rank = {\n          high: 0,\n          med: 1,\n          low: 2\n        };\n        return (rank[ap] ?? 2) - (rank[bp] ?? 2);\n      });\n    }\n    // ---------- Etiquetas y utilidades ----------\n    monthLabel() {\n      const fmt = new Intl.DateTimeFormat('es-ES', {\n        month: 'long',\n        year: 'numeric'\n      });\n      return fmt.format(this.viewDate);\n    }\n    isToday(cell) {\n      const t = new Date();\n      t.setHours(0, 0, 0, 0);\n      const c = new Date(cell.date);\n      c.setHours(0, 0, 0, 0);\n      return t.getTime() === c.getTime();\n    }\n    // Checkers (evitan funciones flecha en el template)\n    hasHigh(cell) {\n      return cell.tasks?.some(t => t?.priority === 'high') ?? false;\n    }\n    hasMed(cell) {\n      return cell.tasks?.some(t => t?.priority === 'med') ?? false;\n    }\n    hasLow(cell) {\n      return cell.tasks?.some(t => t?.priority === 'low') ?? false;\n    }\n    // ---------- Keys de fecha ----------\n    keyFromISO(iso) {\n      const d = new Date(iso);\n      return this.keyFromDate(d);\n    }\n    keyFromDate(d) {\n      const y = d.getFullYear();\n      const m = (d.getMonth() + 1).toString().padStart(2, '0');\n      const dd = d.getDate().toString().padStart(2, '0');\n      return `${y}-${m}-${dd}`;\n    }\n    static {\n      this.ɵfac = function CalendarComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || CalendarComponent)(i0.ɵɵdirectiveInject(i1.TasksService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: CalendarComponent,\n        selectors: [[\"app-calendar\"]],\n        decls: 15,\n        vars: 6,\n        consts: [[1, \"cal-wrapper\"], [1, \"cal-header\"], [1, \"nav-btn\", 3, \"click\"], [1, \"title\"], [1, \"today-btn\", 3, \"click\"], [1, \"cal-grid\"], [\"class\", \"dow\", 4, \"ngFor\", \"ngForOf\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"side\", 4, \"ngIf\"], [1, \"dow\"], [\"class\", \"cell\", 3, \"out\", \"today\", \"click\", 4, \"ngFor\", \"ngForOf\"], [1, \"cell\", 3, \"click\"], [1, \"num\"], [\"class\", \"badges\", 4, \"ngIf\"], [\"class\", \"preview\", 4, \"ngIf\"], [1, \"badges\"], [1, \"badge\", \"count\"], [\"class\", \"badge high\", 4, \"ngIf\"], [\"class\", \"badge med\", 4, \"ngIf\"], [\"class\", \"badge low\", 4, \"ngIf\"], [1, \"badge\", \"high\"], [1, \"badge\", \"med\"], [1, \"badge\", \"low\"], [1, \"preview\"], [4, \"ngIf\"], [1, \"side\"], [1, \"side-title\"], [\"class\", \"task-card\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"hint\", 4, \"ngIf\"], [1, \"task-card\"], [1, \"task-title\"], [1, \"meta\"], [1, \"chip\"], [\"class\", \"chip gray\", 4, \"ngIf\"], [1, \"chip\", \"gray\"], [1, \"hint\"]],\n        template: function CalendarComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"button\", 2);\n            i0.ɵɵlistener(\"click\", function CalendarComponent_Template_button_click_2_listener() {\n              return ctx.prevMonth();\n            });\n            i0.ɵɵtext(3, \"\\u00AB\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"div\", 3);\n            i0.ɵɵtext(5);\n            i0.ɵɵpipe(6, \"titlecase\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(7, \"button\", 2);\n            i0.ɵɵlistener(\"click\", function CalendarComponent_Template_button_click_7_listener() {\n              return ctx.nextMonth();\n            });\n            i0.ɵɵtext(8, \"\\u00BB\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(9, \"button\", 4);\n            i0.ɵɵlistener(\"click\", function CalendarComponent_Template_button_click_9_listener() {\n              return ctx.goToday();\n            });\n            i0.ɵɵtext(10, \"Hoy\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(11, \"div\", 5);\n            i0.ɵɵtemplate(12, CalendarComponent_div_12_Template, 2, 1, \"div\", 6)(13, CalendarComponent_ng_container_13_Template, 2, 1, \"ng-container\", 7);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(14, CalendarComponent_div_14_Template, 7, 3, \"div\", 8);\n            i0.ɵɵelementEnd();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(6, 4, ctx.monthLabel()));\n            i0.ɵɵadvance(7);\n            i0.ɵɵproperty(\"ngForOf\", ctx.dayNames);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngForOf\", ctx.weeks);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.selectedKey);\n          }\n        },\n        dependencies: [i2.NgForOf, i2.NgIf, i2.SlicePipe, i2.TitleCasePipe],\n        styles: [\".cal-wrapper[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 320px;gap:16px}.cal-header[_ngcontent-%COMP%]{grid-column:1 / -1;display:flex;align-items:center;gap:8px;margin:6px 0 2px}.title[_ngcontent-%COMP%]{font-weight:700;font-size:1.2rem;flex:1}.nav-btn[_ngcontent-%COMP%], .today-btn[_ngcontent-%COMP%]{background:#f3f4f6;border:1px solid #e5e7eb;border-radius:8px;padding:6px 10px;cursor:pointer;font-weight:600}.nav-btn[_ngcontent-%COMP%]:hover, .today-btn[_ngcontent-%COMP%]:hover{background:#e5e7eb}.cal-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}.dow[_ngcontent-%COMP%]{font-weight:700;text-align:center;padding:6px 0;color:#374151}.cell[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-radius:10px;min-height:95px;padding:6px;position:relative;cursor:pointer;transition:box-shadow .2s,border-color .2s}.cell[_ngcontent-%COMP%]:hover{border-color:#cbd5e1;box-shadow:0 2px 10px #0000000a}.cell.out[_ngcontent-%COMP%]{background:#fafafa;color:#9ca3af}.cell.today[_ngcontent-%COMP%]{border-color:#2563eb;box-shadow:0 0 0 2px #2563eb26 inset}.num[_ngcontent-%COMP%]{font-weight:700;color:#111827}.badges[_ngcontent-%COMP%]{display:flex;gap:6px;flex-wrap:wrap;margin-top:4px}.badge[_ngcontent-%COMP%]{font-size:11px;padding:2px 6px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb}.badge.count[_ngcontent-%COMP%]{background:#eef2ff;border-color:#e0e7ff;color:#3730a3}.badge.high[_ngcontent-%COMP%]{background:#fee2e2;border-color:#fecaca;color:#991b1b}.badge.med[_ngcontent-%COMP%]{background:#fef9c3;border-color:#fde68a;color:#92400e}.badge.low[_ngcontent-%COMP%]{background:#dcfce7;border-color:#bbf7d0;color:#065f46}.preview[_ngcontent-%COMP%]{list-style:none;margin:6px 0 0;padding:0;font-size:12px;color:#374151}.preview[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.side[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:12px;height:fit-content;position:sticky;top:10px}.side-title[_ngcontent-%COMP%]{font-weight:700;margin-bottom:8px}.task-card[_ngcontent-%COMP%]{border:1px solid #eef2f7;border-radius:10px;padding:8px 10px;margin-bottom:8px}.task-title[_ngcontent-%COMP%]{font-weight:600}.task-title.done[_ngcontent-%COMP%]{text-decoration:line-through;color:#6b7280}.meta[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:6px}.chip[_ngcontent-%COMP%]{font-size:11px;padding:2px 6px;border-radius:999px;background:#f3f4f6;border:1px solid #e5e7eb}.chip.h[_ngcontent-%COMP%]{background:#fee2e2;border-color:#fecaca;color:#991b1b}.chip.m[_ngcontent-%COMP%]{background:#fef9c3;border-color:#fde68a;color:#92400e}.chip.l[_ngcontent-%COMP%]{background:#dcfce7;border-color:#bbf7d0;color:#065f46}.chip.gray[_ngcontent-%COMP%]{background:#e5e7eb;color:#374151}.hint[_ngcontent-%COMP%]{color:#6b7280;font-size:12px;margin-top:8px}@media (max-width: 900px){.cal-wrapper[_ngcontent-%COMP%]{grid-template-columns:1fr}.side[_ngcontent-%COMP%]{position:static}}\"]\n      });\n    }\n  }\n  return CalendarComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}